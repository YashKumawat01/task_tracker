<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Execution Tracker</title>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<link rel="stylesheet" href="style.css">

</head>

<body>
<div class="app">

<!-- LEFT -->
<div class="panel">
  <div class="clock" id="clock"></div>
  <div class="date" id="date"></div>
  <div class="divider"></div>
  <div class="streakBox">
    <span>Streak</span>
    <strong id="streak">0</strong>
    <span>Days</span>
  </div>
</div>

<!-- CENTER -->
<div class="panel">
  <div class="taskHeader">Daily Execution Tasks</div>
  <div class="taskInput">
    <input id="taskInput" placeholder="Define today’s standard">
    <button onclick="addTask()">Add</button>
  </div>
  <ul class="taskList" id="taskList"></ul>
</div>

<!-- RIGHT -->
<div class="panel">
  <div class="sectionTitle">Analytics</div>
  <div class="stats">
    <div class="stat">Total Tasks<strong id="totalTasks">0</strong></div>
    <div class="stat">Completion<strong id="completion">0%</strong></div>
    <div class="stat">Best Streak<strong id="bestStreak">0</strong></div>
    <div class="stat">Missed Days<strong id="missed">0</strong></div>
  </div>

  <div class="sectionTitle">From the Date</div>
  <div style="margin-bottom:16px;">
    <input type="date" id="fromDate" class="dateInput">
  </div>

  <button class="exportBtn" onclick="exportPDF()">Export PDF</button>
</div>

</div>

<script>
const { jsPDF } = window.jspdf;

const STORAGE="EXEC_TASKS";
const HISTORY="EXEC_HISTORY";
const STREAK="EXEC_STREAK";

const today = () => new Date().toDateString();

const clockEl=document.getElementById("clock");
const dateEl=document.getElementById("date");
const taskList=document.getElementById("taskList");
const taskInput=document.getElementById("taskInput");

function clock(){
  const n=new Date();
  clockEl.textContent=n.toLocaleTimeString();
  dateEl.textContent=n.toDateString();
}
setInterval(clock,1000);clock();

function load(){
  let d=JSON.parse(localStorage.getItem(STORAGE))
        ||{date:today(),tasks:[]};

  if(d.date!==today()){
    saveHistory(d);
    d.date=today();
    d.tasks.forEach(t=>t.done=false);
    localStorage.setItem(STORAGE,JSON.stringify(d));
  }

  render(d.tasks);
  stats();
}

function render(tasks){
  taskList.innerHTML="";
  tasks.forEach(task=>{
    const li=document.createElement("li");
    li.className="taskItem"+(task.done?" done":"");

    const cb=document.createElement("input");
    cb.type="checkbox";
    cb.checked=task.done;
    cb.onchange=()=>toggle(task.id);

    const text=document.createElement("span");
    text.textContent=task.text;
    text.style.flex="1";

    const del=document.createElement("button");
    del.textContent="✖";
    del.onclick=()=>deleteTask(task.id);

    li.append(cb,text,del);
    taskList.append(li);
  });
}

function addTask(){
  const v=taskInput.value.trim();
  if(!v)return;
  const d=JSON.parse(localStorage.getItem(STORAGE));
  d.tasks.push({id:Date.now(),text:v,done:false});
  localStorage.setItem(STORAGE,JSON.stringify(d));
  taskInput.value="";
  load();
}

function toggle(id){
  const d=JSON.parse(localStorage.getItem(STORAGE));
  d.tasks.find(t=>t.id===id).done^=1;
  localStorage.setItem(STORAGE,JSON.stringify(d));
  load();
}

function deleteTask(id){
  const d=JSON.parse(localStorage.getItem(STORAGE));
  d.tasks=d.tasks.filter(t=>t.id!==id);
  localStorage.setItem(STORAGE,JSON.stringify(d));
  load();
}

function saveHistory(d){
  const h=JSON.parse(localStorage.getItem(HISTORY))||[];
  h.push(JSON.parse(JSON.stringify(d)));
  localStorage.setItem(HISTORY,JSON.stringify(h));
  updateStreak(d.tasks.length&&d.tasks.every(t=>t.done));
}

function updateStreak(ok){
  let s=JSON.parse(localStorage.getItem(STREAK))
        ||{current:0,best:0,missed:0};
  if(ok){
    s.current++;
    s.best=Math.max(s.best,s.current);
  }else{
    s.current=0;
    s.missed++;
  }
  localStorage.setItem(STREAK,JSON.stringify(s));
}

function stats(){
  const d=JSON.parse(localStorage.getItem(STORAGE));
  const s=JSON.parse(localStorage.getItem(STREAK))
        ||{current:0,best:0,missed:0};
  totalTasks.textContent=d.tasks.length;
  const done=d.tasks.filter(t=>t.done).length;
  completion.textContent=d.tasks.length
    ?Math.round(done/d.tasks.length*100)+"%"
    :"0%";
  streak.textContent=s.current;
  bestStreak.textContent=s.best;
  missed.textContent=s.missed;
}

function exportPDF(){
  const fromVal=document.getElementById("fromDate").value;
  if(!fromVal){
    alert("Select starting date");
    return;
  }

  const from=new Date(fromVal);
  const now=new Date();

  const h=JSON.parse(localStorage.getItem(HISTORY))||[];
  const filtered=h.filter(d=>{
    const dd=new Date(d.date);
    return dd>=from && dd<=now;
  });

  if(!filtered.length){
    alert("No data for selected range");
    return;
  }

  const doc=new jsPDF();
  let y=10;

  doc.text("Execution Report",10,y);
  y+=10;

  filtered.forEach(day=>{
    doc.text(day.date,10,y);
    y+=8;
    day.tasks.forEach(t=>{
      doc.text(`- ${t.text} : ${t.done?"DONE":"MISS"}`,14,y);
      y+=6;
      if(y>280){doc.addPage();y=10;}
    });
    y+=6;
  });

  doc.save("execution-report.pdf");
}

load();
</script>
</body>
</html>
